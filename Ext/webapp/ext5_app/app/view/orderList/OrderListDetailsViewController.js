/*
 * File: app/view/menu/menuPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Evcorp.view.orderList.OrderListDetailsViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.OrderListDetails',
    control : {
		'#' : {
			afterlayout : 'onViewShow',
		}
	},
	onViewShow:function(){
		var viewModel = this.getView().ownerCt.getViewModel();
		if (viewModel) {
			var store = viewModel.getStore('detail');
			if (store && store.data && store.data.items && store.data.items.length>0) {
				var data = store.data.items[0].data;
				if (data) {
					var monthlyManagementFeeRef = this.lookupReference('monthlyManagementFeeRef'); // 保险费用及充电桩使用服务费（元）
		    		var chargeFeeRef = this.lookupReference('chargeFeeRef'); // 充电桩费用（元）
//		    		var financialPackageCode = this.lookupReference('financialPackageCodeRef').getValue(); // 金融套餐
		    		var financialPackageCode = data.financialPackageCode; // 金融套餐
		    		
		    		if (financialPackageCode=='cxz_std') {
		    			monthlyManagementFeeRef.show();
		    			monthlyManagementFeeRef.setDisabled(false);
		    			chargeFeeRef.hide();
		    			chargeFeeRef.setDisabled(true);
		    		} else {
		    			monthlyManagementFeeRef.hide();
		    			monthlyManagementFeeRef.setDisabled(true);
		    			chargeFeeRef.show();
		    			chargeFeeRef.setDisabled(false);
		    		}
				}
			}
		}
    	console.log("xxx");
    },
    orderPayTypeEditor : function (value) {
    	if(value){
    		var gridStore = this.getView().getViewModel().getStore('orderPayTypeStore');
        	return gridStore.findRecord('code', value).data.nameCn;
    	}
    },
    orderPayChannelEditor : function (value) {
    	if(value){
    		var gridStore = this.getView().getViewModel().getStore('orderPayChannelStore');
        	return gridStore.findRecord('code', value).data.nameCn;
    	}
    },
    insuranceCompanyEditor:function(value){
		if(value!=undefined){
			var insuranceCompanyStore=this.getView().getViewModel().getStore('insuranceCompanyStore');
			return insuranceCompanyStore.findRecord('code', value).data.nameCn;
		}
	},
	
	// 上传车辆及保险信息附件
    onUploadCarBXClick : function (grid, rowIndex) {
    	var ccsaGridStore = grid.getStore();
        var rec = ccsaGridStore.getAt(rowIndex);
        var carInfoCode = rec.get('carInfoCode');
        if (!carInfoCode) {
        	Ext.Msg.alert('提示','配车资产编号为空，无法查看附件！');
        	return;
        }
    	var businessKey = carInfoCode; // 附件业务实体编号：车辆资产编号
    	var businessType = 'attachBizEntityType_ZCGL'; // 附件业务实体类型：资产管理代码
    	var businessTypeName = '资产管理'; // 附件业务实体类型名称：资产管理（理论上从字典表去nameCn字段）
    	
//    	var uploadCarBXAttachmentPanel = Ext.ComponentQuery.query('#uploadCarBXAttachmentPanelItemId');
//    	var uploadAddBtn = uploadCarBXAttachmentPanel[0].down("#addAttachementBtnItemId");
//    	uploadAddBtn.fireEvent('click');
    	
		var uploadAttachmenWin = Ext.create({
			xtype:'UploadAttachmentWin',
			width : 800,
			height : '60%',
			businessKey:businessKey,
			businessType:businessType,
			businessTypeName:businessTypeName,
			closeAction : 'destroy'
		});
		var uploadAttachmentPanel = uploadAttachmenWin.down('#uploadAttachmentPanelItemId');// 附件Panel
		uploadAttachmentPanel.setTitle('');
		uploadAttachmenWin.show();
		// 隐藏新增按钮，隐藏操作列
		uploadAttachmentPanel.down('button').hide();
		uploadAttachmentPanel.down('gridpanel').columns[uploadAttachmentPanel.down('gridpanel').columns.length-1].hide();
    },
    
    // 上传租赁合同附件
    onUploadContractAttachemetClick : function() {
        var olPreSaleOrderNo = this.lookupReference('olPreSaleOrderNoRef').getValue();
        
        if (!olPreSaleOrderNo) {
        	Ext.Msg.alert('提示','请租赁合同编号为空，无法查看附件！');
        	return;
        }
        
        var businessKey = olPreSaleOrderNo; // 附件业务实体编号：租赁合同编号
    	var businessType = 'attachBizEntityType_ZLHT'; // 附件业务实体类型：租赁合同代码
    	var businessTypeName = '租赁合同'; // 附件业务实体类型名称：租赁合同（理论上从字典表去nameCn字段）
        
        var uploadAttachmenWin = Ext.create({
			xtype:'UploadAttachmentWin',
			width : 800,
			height : '60%',
			businessKey:businessKey,
			businessType:businessType,
			businessTypeName:businessTypeName,
			closeAction : 'destroy'
		});
		var uploadAttachmentPanel = uploadAttachmenWin.down('#uploadAttachmentPanelItemId');// 附件Panel
		uploadAttachmentPanel.setTitle('');
		uploadAttachmenWin.show();
		// 隐藏新增按钮，隐藏操作列
		uploadAttachmentPanel.down('button').hide();
		uploadAttachmentPanel.down('gridpanel').columns[uploadAttachmentPanel.down('gridpanel').columns.length-1].hide();
    },
    // 下载合同附件
    onDownContractClick:function(){
    	var olPreSaleOrderNo = this.lookupReference('olPreSaleOrderNoRef').getValue();
    	if (!olPreSaleOrderNo) {
        	Ext.Msg.alert("提示",'租赁合同编号为空。');
        	return;
        }
        var customerName = this.lookupReference('customerNameRef').getValue();
        var dingJinFee = this.lookupReference('dingJinFeeRef').getValue();
        dingJinFee = dingJinFee == null ? '' : dingJinFee;
		window.location.href = 'ccOrder/download/contract?olPreSaleOrderNo='+olPreSaleOrderNo+'&customerName='+customerName;
	},
	// 上传补充协议
    onUploadBCXYClick : function (grid, rowIndex) {
    	var ccsaGridStore = grid.getStore();
        var rec = ccsaGridStore.getAt(rowIndex);
        var suppleAgreementNo = rec.get('suppleAgreementNo');
        if (!suppleAgreementNo) {
        	Ext.Msg.alert('提示','请补充协议编号为空，无法查看附件！');
        	return;
        }
    	var businessKey = suppleAgreementNo; // 附件业务实体编号：租赁合同编号
    	var businessType = 'attachBizEntityType_ZLHT'; // 附件业务实体类型：租赁合同代码
    	var businessTypeName = '租赁合同'; // 附件业务实体类型名称：租赁合同（理论上从字典表去nameCn字段）
    	
    	var uploadAttachmenWin = Ext.create({
			xtype:'UploadAttachmentWin',
			width : 800,
			height : '60%',
			businessKey:businessKey,
			businessType:businessType,
			businessTypeName:businessTypeName,
			closeAction : 'destroy'
		});
		var uploadAttachmentPanel = uploadAttachmenWin.down('#uploadAttachmentPanelItemId');// 附件Panel
		uploadAttachmentPanel.setTitle('');
		uploadAttachmenWin.show();
		// 隐藏新增按钮，隐藏操作列
		uploadAttachmentPanel.down('button').hide();
		uploadAttachmentPanel.down('gridpanel').columns[uploadAttachmentPanel.down('gridpanel').columns.length-1].hide();
    },
    // 打印补充协议
    onPrintBCXYClick : function (grid, rowIndex) {
        var olPreSaleOrderNo = this.lookupReference('olPreSaleOrderNoRef').getValue();
        var contractCarCode = this.lookupReference('contractCarCodeRef').getValue();
        var customerName = this.lookupReference('customerNameRef').getValue();
        var ccsaGridStore = grid.getStore();
        var rec = ccsaGridStore.getAt(rowIndex);
        var bankAccountName='';
    	var bankAccountNo='';
    	var bankOpenPlace='';
        var bankCardInfoStore = this.getView().getViewModel().getStore('bankCardInfoStore');
        if (bankCardInfoStore && rec.data.bankCardInfoId && bankCardInfoStore.findRecord('id', rec.data.bankCardInfoId)) {
        	var bankCardInfo = bankCardInfoStore.findRecord('id', rec.data.bankCardInfoId).data.bankAccountInfo;
        	var bankCardInfoArray = bankCardInfo.split(' ');
        	if (bankCardInfoArray.length>=3) {
        		bankAccountNo=bankCardInfoArray[0];
        		bankAccountName=bankCardInfoArray[1];
            	bankOpenPlace=bankCardInfoArray[2];
        	}
        }
		window.location.href = 'ccOrder/download/bcxy?'
			+ params;
    },
    // 上传支付信息附件
	onUploadContractCarOrderPayClick : function (grid, rowIndex) {
    	var ccsaGridStore = grid.getStore();
        var rec = ccsaGridStore.getAt(rowIndex);
        var id = rec.get('id');
        var payNo = rec.get('payNo');
        if (!payNo) {
        	Ext.Msg.alert('提示','支付编码为空，无法进行上传操作！');
        	return;
        }
    	var businessKey = payNo; // 附件业务实体编号：支付编号
    	var businessType = 'attachBizEntityType_ZFXX'; // 附件业务实体类型：支付类型代码
    	var businessTypeName = '支付信息'; // 附件业务实体类型名称：支付类型（理论上从字典表去nameCn字段）
    	
    	var uploadAttachmenWin = Ext.create({
			xtype:'UploadAttachmentWin',
			width : 800,
			height : '60%',
			businessKey:businessKey,
			businessType:businessType,
			businessTypeName:businessTypeName,
			closeAction : 'destroy'
		});
		var uploadAttachmentPanel = uploadAttachmenWin.down('#uploadAttachmentPanelItemId');// 附件Panel
		uploadAttachmentPanel.setTitle('');
		uploadAttachmenWin.show();
		// 隐藏新增按钮，隐藏操作列
		uploadAttachmentPanel.down('button').hide();
		uploadAttachmentPanel.down('gridpanel').columns[uploadAttachmentPanel.down('gridpanel').columns.length-1].hide();
    },
});
