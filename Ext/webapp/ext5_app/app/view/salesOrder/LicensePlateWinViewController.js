/*
 * File: app/view/menu/menuPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Evcorp.view.salesOrder.LicensePlateWinViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.licensePlateWin',
    initWindow:function(){
    	var win = this.getView();
    	var businessKey = win.businessKey; 
    	var businessType = 'attachBizEntityType_XSSP'; // 附件业务实体类型：合同材料代码
    	var businessTypeName = '销售上牌材料'; 
		
		var uploadAttachmentPanel = win.down('uploadAttachmentPanel');
		if(uploadAttachmentPanel!=null){
			var attachmentStore = uploadAttachmentPanel.getViewModel().getStore('attachmentStore');
			if(attachmentStore!=null){
				attachmentStore.load({params:{bizEntityCode:businessKey,bizEntityType:businessType}});
			}
			var typeStore = uploadAttachmentPanel.getViewModel().getStore('attachmentTypeStore');
	    	typeStore.load({params:{type:businessType}});
	    	var form = uploadAttachmentPanel.down('form');
	    	if(form!=null){
	    		form.getForm().setValues({businessKey:businessKey,businessType:businessType,businessTypeName:businessTypeName});
	    	}
		}
    },
    saveLicensePlate:function(){
    	var form = this.lookupReference('licensePlateForm');
    	var isValid = form.getForm().isValid();
		var drivingLicenceText = Ext.ComponentQuery.query('#drivingLicenceItem')[0];
		var plateNumberText = Ext.ComponentQuery.query('#plateNumberItem')[0];
    	if(isValid){
			Ext.Ajax.request({
				url : 'salesOrder/saveLicensePlate',
				params : {
					'saleOrderNo':form.getForm().getValues().saleOrderNo,
					'drivingLicence':form.getForm().getValues().drivingLicence,
					'plateNumber':form.getForm().getValues().plateNumber
				},
	            method: 'POST',	
				success : function(data) {
					if(data.responseText=='success'){
						Ext.Msg.alert("提示", '保存成功！');
						drivingLicenceText.setValue(form.getForm().getValues().drivingLicence);
						plateNumberText.setValue(form.getForm().getValues().plateNumber);
					}
				}
			});
    	}
    }
});
