/*
 * File: app/view/menu/menuPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Evcorp.view.salesOrder.InsuranceWinViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.insuranceWin',
    onInsuranceSaveClick:function(){
    	var form = this.lookupReference('insuranceWinForm');
    	var insuranceTermsText = Ext.ComponentQuery.query('#insuranceTermsItem')[0];
    	var actualInsAmountText = Ext.ComponentQuery.query('#saleOrderActualInsAmountItem')[0];
		var win = this.getView();
		var isValid = form.getForm().isValid();
		var insuranceTerms=form.getForm().getValues().insuranceTerms;
		var jqInsuranceAmount=form.getForm().getValues().jqInsuranceAmount;
		var bizInsuranceAmount=form.getForm().getValues().bizInsuranceAmount;
		var actualInsAmount=parseFloat(jqInsuranceAmount)+parseFloat(bizInsuranceAmount);
		if (isValid) {
			form.getForm().submit({
				success : function(form, action) {
					Ext.Msg.alert("提示", "保存成功");
					insuranceTermsText.setValue(insuranceTerms);
					actualInsAmountText.setValue(actualInsAmount);
					actualInsAmountText.fireEvent('change',actualInsAmountText,actualInsAmount,0);
					win.close();
				},
				failure : function(form, action) {
					Ext.Msg.alert("提示", "系统错误，保存失败");
//					win.close();
				}
			})
		} else {
			Ext.Msg.alert("提示", '请把信息填完整');
		}
    }
});
