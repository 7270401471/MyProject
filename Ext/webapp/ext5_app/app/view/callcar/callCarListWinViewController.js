/*
 * File: app/view/menu/menuPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Evcorp.view.callcar.callCarListWinViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.callCarListWin',
    onConfirmClick:function(){
    	var grid = this.lookupReference("carProductGrid");
    	var sel = grid.getSelectionModel().getSelection();
    	var win = this.getView();
    	var detailGrid = Ext.ComponentQuery.query("#callCarDemandDetailGridId")[0];
    	var detailStore = detailGrid.getStore();
    	var detailSel = detailGrid.getSelectionModel().getSelection();
    	if(sel.length>0){
    		var carProduct = sel[0].data;
    		var items = detailStore.getData().items;
    		var flag = false;
    		Ext.each(items,function(item){
    			if(carProduct.code==item.data.carProductCode){
    				flag = true;
    			}
    		});
    		if(flag){
    			Ext.Msg.alert('提示','该车型已添加，请勿重复添加');
    		}else{
    			var detail = detailStore.getById(detailSel[0].data.id);
        		detail.set('carProductCode',carProduct.code);
        		detail.set('carBrandCode',carProduct.carBrandCode);
        		detail.set('carSeriesCode',carProduct.carSeriesCode);
        		detail.set('carModelCode',carProduct.carModelCode);
        		detail.set('name',carProduct.displayName);
            	win.close();
    		}
    	}else{
    		Ext.Msg.alert('提示','请先选择一个供应商！');
    	}
    },
    onQueryClick:function(){
    	var carSearch = this.lookupReference('carProductField');
    	//var carProductIsContract = this.lookupReference('carProductIsContract');
    	var carProductGrid = this.lookupReference('carProductGrid');
    	var extraParams = {
    			name : carSearch.getValue(),
    			//isContract:"true"
    			};
    	var carProductStore = carProductGrid.getStore();
    	carProductStore.on("beforeload", function(carProductStore,
				operation, eOpts) {
			Ext.apply(carProductStore.proxy.extraParams,
					extraParams);
		});
    	carProductStore.loadPage(1, {
			"start" : 0,
			"limit" : 20
		});
    	
    },
    onRowDbClick:function(grid,record,tr){
    	var win = this.getView();
    	var detailGrid = Ext.ComponentQuery.query("#callCarDemandDetailGridId")[0];
    	var detailStore = detailGrid.getStore();
    	var detailSel = detailGrid.getSelectionModel().getSelection();
		var carProduct = record.data;
		var items = detailStore.getData().items;
		var flag = false;
		Ext.each(items,function(item){
			if(carProduct.code==item.data.carProductCode){
				flag = true;
			}
		});
		if(flag){
			Ext.Msg.alert('提示','该车型已添加，请勿重复添加');
		}else{
			var detail = detailStore.getById(detailSel[0].data.id);
    		detail.set('carProductCode',carProduct.code);
    		detail.set('carBrandCode',carProduct.carBrandCode);
    		detail.set('carSeriesCode',carProduct.carSeriesCode);
    		detail.set('carModelCode',carProduct.carModelCode);
    		detail.set('name',carProduct.displayName);
        	win.close();
		}
    }
});
