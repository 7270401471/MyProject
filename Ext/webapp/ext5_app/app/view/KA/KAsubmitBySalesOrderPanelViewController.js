/*
 * File: app/view/role/RoleMangerPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Evcorp.view.KA.KAsubmitBySalesOrderPanelViewController', {
	extend : 'Ext.app.ViewController',
	alias : 'controller.KAsubmitBySalesOrderPanel',
	control: {
	  "#": {
		  afterrender : 'hiddenBtnByRole'
	  }
	},
	hiddenBtnByRole:function (compent, eOpts) {
		var addBtn = this.getView().down('#addBtnItemId');
		var modifyBtn = this.getView().down('#modifyBtnItemId');
		// 删除操作
		Ext.Ajax.request({
			url : 'snCusSalesOrder/getCurUserRole',
			async : false,
			success : function(response) {
				if(response.status==200 && response.statusText=='OK'){
					var responseText = JSON.parse(response.responseText);
					if (responseText.isSnCustomerOrAdmin=='N') {
//						addBtn.hide();
						modifyBtn.hide();
					}
				}
			}
		});
	},
	onQuerySalesOrder:function() {
		var queryForm = this.lookupReference('snCustomerSalesOrderSearchForm');
		var extraParams = queryForm.getForm().getValues();
	    var listGrid = this.lookupReference('snCustomerSalesOrderGridRef');
	    var dataStore = listGrid.getStore();
        dataStore.on("beforeload", function (dataStore, operation, eOpts) {
					 	Ext.apply(dataStore.proxy.extraParams, extraParams);
					});
        dataStore.loadPage(1,{"start":0,"limit":20});
        listGrid.getSelectionModel().deselectAll();
	},
	onExportSalesOrder:function() {
		
		var queryForm = this.lookupReference('snCustomerSalesOrderSearchForm');
		var extraParams = queryForm.getForm().getValues();
	    var params = 'status='+extraParams.status+'&cusName='+extraParams.cusName+'&vin='+extraParams.vin
	    				+'&createDateStart='+extraParams.createDateStart+'&createDateEnd='+extraParams.createDateEnd;
	    
	    window.location.href = 'snCusSalesOrder/exportSnCusSaleOrder?' + params;
	},
	onKAadd : function() {
		var KAsubmitwin = Ext.create({
			xtype : 'KAsubmitEditWin',
			width : 1000,
			height : '80%',
			closeAction : 'destroy',
		});
		KAsubmitwin.show();
		
		// 附件处理
		
	},
/*流程 on*/
	onCredit : function() {
		var KAsubmitwin = Ext.create({
			xtype : 'KAcreditCheckWin',
			width : 1000,
			height : '500px',
			closeAction : 'destroy',
		});
		KAsubmitwin.show();
		
	},
	oncreditReview : function() {
		var KAsubmitwin = Ext.create({
			xtype : 'KAcreditReviewWin',
			width : 1000,
			height : '80%',
			closeAction : 'destroy',
		});
		KAsubmitwin.show();
		
	},
	/*流程 end*/
	onKAedit1 : function() {
		var KAsubmitwin = Ext.create({
			xtype : 'KAsubmitEditWin',
			width : 1000,
			height : '80%',
			closeAction : 'destroy',
		});
		KAsubmitwin.show();
		
	},
	onKAedit : function() {
		var snCustomerSalesOrderGrid = this.lookupReference('snCustomerSalesOrderGridRef');
    	var sel = snCustomerSalesOrderGrid.getSelectionModel().getSelection();
    	if (sel.length<=0) {
    		Ext.Msg.alert("提示",'请选择一条要修改的信息！');
    		return;
    	}
    	var data = sel[0].data;
    	var win = Ext.create({
			xtype : 'KAsubmitEditWin',
			width : 1000,
			height : '80%',
			closeAction : 'destroy',
		});
    	
    	win.down('#idItemId').setValue(data.id);
    	win.down('#codeItemId').setValue(data.code);
    	win.down('#createByItemId').setValue(data.createBy);
    	win.down('#createDateItemId').setValue(data.createDate);
    	win.down('#statusItemId').setValue(data.status);
    	win.down('#deliveryManItemId').setValue(data.deliveryMan);
    	win.down('#deliveryDateItemId').setValue(data.deliveryDate);
    	win.down('#snCustomerCodeItemId').setValue(data.snCustomerCode);
    	win.down('#snCustomerNameItemId').setValue(data.snCustomerName);
    	win.down('#snCustomerContactUserNameItemId').setValue(data.snCustomerContactUserName);
    	win.down('#snCustomerContactUserPhoneItemId').setValue(data.snCustomerContactUserPhone);
    	win.down('#carProductCodeItemId').setValue(data.carProductCode);
    	win.down('#productNameItemId').setValue(data.productName);
    	win.down('#cusNameItemId').setValue(data.cusName);
    	win.down('#cusIdTypeItemId').setValue(data.cusIdType);
    	win.down('#cusIdNumItemId').setValue(data.cusIdNum);
    	win.down('#birthdayItemId').setValue(data.birthday);
    	win.down('#nationalityItemId').setValue(data.nationality);
    	win.down('#cusNatureItemId').setValue(data.cusNature);
    	win.down('#vinItemId').setValue(data.vin);
    	win.down('#carEngineNoItemId').setValue(data.carEngineNo);
    	win.down('#storageCodeItemId').setValue(data.storageCode);
    	win.down('#slocCodeItemId').setValue(data.slocCode);
    	win.down('#dispatchedDateItemId').setValue(data.dispatchedDate);
    	win.down('#chargerMethodItemId').setValue(data.chargerMethod);
    	win.down('#isFixedParkItemId').setValue(data.isFixedPark);
    	win.down('#chargerFeeItemId').setValue(data.chargerFee);
    	win.down('#directivePriceItemId').setValue(data.directivePrice);
    	win.down('#actualPriceItemId').setValue(data.actualPrice);
    	win.down('#orderAmountItemId').setValue(data.orderAmount);
    	win.down('#receiveMoneyConfirmDateItemId').setValue(data.receiveMoneyConfirmDate);
    	win.down('#isReceiveMoneyItemId').setValue(data.isReceiveMoney);
    	win.down('#contractNoItemId').setValue(data.contractNo);
    	win.down('#contractNoOldItemId').setValue(data.contractNo);
    	win.down('#contractSignedDateItemId').setValue(data.contractSignedDate);
    	win.down('#remarkItemId').setValue(data.remark);
    	
    	win.show();

	},

});