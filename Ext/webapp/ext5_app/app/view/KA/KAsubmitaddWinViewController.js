/*
 * File: app/view/menu/menuPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Evcorp.view.KA.KAsubmitaddWinViewController', {
	extend : 'Ext.app.ViewController',
	alias : 'controller.KAsubmitaddWin',
	control: {
    },
    // 查询产品
	queryCarList : function() {
		var form = this.lookupReference('snCreditInfoForm');
		var data = form.getForm().getValues();
		var buyType = data.buyType;
		if (!buyType) {
			Ext.Msg.alert("提示", "请先选择购买方式！");
			return;
		}
		var window = Ext.create({
//			xtype : 'carProductsWin',
			xtype : 'CarProductBySnCustomerListWin',
			closeAction : 'destroy'
		});
    	window.getViewModel().getStore('carProductStore').getProxy().extraParams = {
    		productType : buyType
		};
		window.down('#selectContractCarId').on({
			click : 'onSnCreditInfoSelectCar'
		}),
		window.down('#productTypeItemId').setValue(buyType);
		window.show();
	},
	// 保存
	onSaveClick : function() {
		var form = this.lookupReference('snCreditInfoForm').getForm();
		var grid = Ext.ComponentQuery.query("viewport KAsubmitPanel #snCreditInfoGrid")[0];
		var store = grid.getStore();
		if (!form.isValid()) {
			return;
		}
		form.findField('operateType').setValue('SAVE');
		var win = this.getView();
		form.submit({
			success : function(form, action) {
				if (action.result.errorMsg) {
					Ext.Msg.alert("提示", action.result.errorMsg);
				} else {
					Ext.Msg.alert("提示", "保存成功！");
					store.reload();
					win.close();
				}
			},
			failure : function(form, action) {
				Ext.Msg.alert("提示", "系统错误，操作失败！");
			}
		})
	},
	// 提交征信
	onSubmitCreditClick : function() {
		var form = this.lookupReference('snCreditInfoForm').getForm();
		var grid = Ext.ComponentQuery.query("viewport KAsubmitPanel #snCreditInfoGrid")[0];
		var store = grid.getStore();
		if (!form.isValid()) {
			return;
		}
		form.findField('operateType').setValue('TJZX');
		var win = this.getView();
		form.submit({
			success : function(form, action) {
				if (action.result.errorMsg) {
					Ext.Msg.alert("提示", action.result.errorMsg);
				} else {
					Ext.Msg.alert("提示", "提交征信成功！");
					store.reload();
					win.close();
				}
			},
			failure : function(form, action) {
				Ext.Msg.alert("提示", "系统错误，操作失败！");
			}
		})
	},
	
//	// 购买方式变动
//	onBuyTypeChange : function () {
//		var form = this.lookupReference('snCreditInfoForm').getForm();
//		// 清空产品信息
//		form.findField('carProductCode').setValue('');
//		form.findField('carProductName').setValue('');
//	},

});
