/*
 * File: app/view/menu/menuPanelViewController.js
 *
 * This file was generated by Sencha Architect version 3.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Evcorp.view.INV.stockInListWinViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.stockInListWin',
    onStockInListWinCancel : function() {
    	 this.closeView();
    },
    // 入库保存
    onSaveStock : function () {
		var carStockInForm = this.lookupReference('carStockInForm').getForm();
		var fieldValues = carStockInForm.getFieldValues();
		if (!carStockInForm.isValid()) {
			return;
		}
		if (fieldValues.acceptanceResult=='2' && !fieldValues.acceptanceRemark) {
			Ext.Msg.alert('提示','验收结果为不通过，请输入验收备注！');
			return;
		}
//		fieldValues.stockInType=carStockInForm.findField('stockInType').value;
//		fieldValues.lastStockInDate=carStockInForm.findField('lastStockInDate').value;
		var win = this.getView();
		carStockInForm.submit({
			success : function(form, action) {
				if (action.result.errorMsg) {
					Ext.Msg.alert("提示", action.result.errorMsg);
				} else {
					Ext.Msg.alert("提示", "保存成功");
					var grid = Ext.ComponentQuery.query("viewport stockSearchPanel #carStockGridItemId")[0];
					grid.getStore().reload();
					win.close();
				}
			},
			failure : function(form, action) {
				Ext.Msg.alert("提示", "系统错误，保存失败");
			}
		})
    },
    onCarProductSearch : function() {
    	var contractCarListWindow = Ext.create({
			xtype : 'carProductsWin',
			closeAction : 'destroy'
		});
		// contractCarListWindow.down('#selectContractCarId').removeListener(
		// 'click', 'onChoiceClick');
		contractCarListWindow.down('#selectContractCarId').on({
			click : 'onCarStockSelectCar'
		})
		contractCarListWindow.show();
		
    },
    // 查找供应商
    onProviderSearch : function() {
    	var carStockInForm = this.lookupReference('carStockInForm');
    	var carProviderListWin = Ext.create({
    		 xtype : 'carProviderListWin',
    		 width : 600,
    		 closeAction : 'destroy'
    	});
    	carProviderListWin.show();
    	carProviderListWin.down('#carProviderOkBtn').on('click', function () {
    		var grid = Ext.ComponentQuery.query("#carVenderGridItemId")[0]
        	var sel = grid.getSelectionModel().getSelection();
    		if (sel.length <= 0) {
    			Ext.Msg.alert('提示','请先选择一个供应商！');
    			return;
    		}
    		var vender = sel[0].data;
        	if(carStockInForm!=null){
        		carStockInForm.getForm().findField('venderCode').setValue(vender.code);
        		carStockInForm.getForm().findField('venderName').setValue(vender.fullName);
        	}
        	carProviderListWin.close();
    	});
    },
});
